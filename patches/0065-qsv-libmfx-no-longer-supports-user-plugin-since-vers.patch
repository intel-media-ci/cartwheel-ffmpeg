From 140a1b3223abd5d437e524d523dd300fd482d27e Mon Sep 17 00:00:00 2001
From: Haihao Xiang <haihao.xiang@intel.com>
Date: Tue, 18 Aug 2020 15:20:38 +0800
Subject: [PATCH 65/69] qsv: libmfx no longer supports user plugin since
 version 2.0 (oneVPL)

See
https://spec.oneapi.com/versions/latest/elements/oneVPL/source/VPL_intel_media_sdk.html#msdk-full-name-feature-removals
https://github.com/oneapi-src/oneVPL
---
 libavcodec/qsv.c | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/libavcodec/qsv.c b/libavcodec/qsv.c
index ea14f11737..8c7c180d7d 100644
--- a/libavcodec/qsv.c
+++ b/libavcodec/qsv.c
@@ -19,7 +19,6 @@
  */
 
 #include <mfxvideo.h>
-#include <mfxplugin.h>
 #include <mfxjpeg.h>
 
 #include <stdio.h>
@@ -42,6 +41,10 @@
 #include "mfxvp8.h"
 #endif
 
+#if !QSV_VERSION_ATLEAST(2, 0)
+#include <mfxplugin.h>
+#endif
+
 int ff_qsv_codec_id_to_mfx(enum AVCodecID codec_id)
 {
     switch (codec_id) {
@@ -352,6 +355,7 @@ enum AVPictureType ff_qsv_map_pictype(int mfx_pic_type)
 static int qsv_load_plugins(mfxSession session, const char *load_plugins,
                             void *logctx)
 {
+#if !QSV_VERSION_ATLEAST(2, 0)
     if (!load_plugins || !*load_plugins)
         return 0;
 
@@ -395,6 +399,7 @@ load_plugin_fail:
         if (err < 0)
             return err;
     }
+#endif
 
     return 0;
 
-- 
2.17.1

